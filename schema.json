{
  "$id": "https://raw.githubusercontent.com/okteto/okteto/af/validate-2/schema.json",
  "$schema": "2.0.0",
  "additionalProperties": false,
  "properties": {
    "build": {
      "additionalProperties": false,
      "description": "A list of images to build as part of your development environment.",
      "patternProperties": {
        ".*": {
          "additionalProperties": false,
          "description": "The build configuration for your image",
          "properties": {
            "args": {
              "description": "Add build arguments, which are environment variables accessible only during the build process. Build arguments with a value containing a $ sign are resolved to the environment variable value on the machine Okteto is running on.",
              "patternProperties": {
                ".*": {
                  "type": "string"
                }
              },
              "title": "args",
              "type": "object"
            },
            "context": {
              "description": "The build context. Relative paths are relative to the location of the Okteto Manifest (default: .)",
              "title": "context",
              "type": "string"
            },
            "depends_on": {
              "description": "The name of the service that the current service depends on. The service will be built after the service it depends on is built. If the service it depends on is not defined in the Okteto Manifest, the build will fail.",
              "title": "depends_on",
              "type": "string"
            },
            "dockerfile": {
              "description": "The path to the Dockerfile. Relative paths are relative to the location of the Okteto Manifest (default: Dockerfile)",
              "title": "dockerfile",
              "type": "string"
            },
            "image": {
              "description": "The name of the image to build and push. In clusters that have Okteto installed, this is optional (if not specified, the Okteto Registry is used).",
              "title": "image",
              "type": "string"
            },
            "secrets": {
              "patternProperties": {
                ".*": {
                  "type": "string"
                }
              },
              "type": "object"
            },
            "target": {
              "description": "The target build stage in the Dockerfile. If not specified, the default target is used.",
              "title": "target",
              "type": "string"
            }
          },
          "title": "Name of your image",
          "type": "object"
        }
      },
      "title": "build",
      "type": "object"
    },
    "context": {
      "description": "The build context. Relative paths are relative to the location of the Okteto Manifest (default: .)",
      "examples": [
        "api"
      ],
      "title": "context",
      "type": "string"
    },
    "dependencies": {
      "description": "A list of repositories you want to deploy as part of your development environment.",
      "oneOf": [
        {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        {
          "patternProperties": {
            ".*": {
              "additionalProperties": false,
              "properties": {
                "branch": {
                  "description": "The Git branch to use",
                  "title": "branch",
                  "type": "string"
                },
                "manifest": {
                  "description": "The path to the Okteto manifest file in the repository",
                  "title": "manifest",
                  "type": "string"
                },
                "repository": {
                  "description": "The Git repository URL of the dependency",
                  "title": "repository",
                  "type": "string"
                },
                "timeout": {
                  "description": "Maximum time to wait for the dependency to be ready",
                  "pattern": "^[0-9]+(h|m|s)$",
                  "title": "timeout",
                  "type": "string"
                },
                "variables": {
                  "description": "Environment variables to pass to the dependency",
                  "patternProperties": {
                    ".*": {
                      "type": "string"
                    }
                  },
                  "title": "variables",
                  "type": "object"
                },
                "wait": {
                  "description": "Whether to wait for the dependency to be ready",
                  "title": "wait",
                  "type": "boolean"
                }
              },
              "required": [
                "repository"
              ],
              "type": "object"
            }
          },
          "type": "object"
        }
      ],
      "title": "dependencies"
    },
    "deploy": {
      "description": "The deployment configuration for your development environment. This feature is only supported in clusters that have Okteto installed. https://www.okteto.com/docs/reference/okteto-manifest/#deploy-string-optional",
      "oneOf": [
        {
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "additionalProperties": false,
                "properties": {
                  "command": {
                    "description": "Command to execute",
                    "type": "string"
                  },
                  "name": {
                    "description": "Name of the command",
                    "type": "string"
                  }
                },
                "required": [
                  "command"
                ],
                "type": "object"
              }
            ]
          },
          "type": "array"
        },
        {
          "additionalProperties": false,
          "properties": {
            "commands": {
              "description": "List of commands to execute",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "command": {
                        "description": "Command to execute",
                        "type": "string"
                      },
                      "name": {
                        "description": "Name of the command",
                        "type": "string"
                      }
                    },
                    "required": [
                      "command"
                    ],
                    "type": "object"
                  }
                ]
              },
              "type": "array"
            },
            "compose": {
              "oneOf": [
                {
                  "description": "Path to the compose file",
                  "type": "string"
                },
                {
                  "description": "List of compose configurations",
                  "items": {
                    "additionalProperties": false,
                    "properties": {
                      "file": {
                        "description": "Path to the compose file",
                        "type": "string"
                      },
                      "services": {
                        "description": "List of services to deploy",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      }
                    },
                    "required": [
                      "file"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                }
              ]
            },
            "context": {
              "description": "Context for deployment",
              "type": "string"
            },
            "endpoints": {
              "description": "List of endpoints",
              "items": {
                "additionalProperties": false,
                "properties": {
                  "path": {
                    "description": "Path for the endpoint",
                    "type": "string"
                  },
                  "port": {
                    "description": "Port number",
                    "type": "integer"
                  },
                  "service": {
                    "description": "Service name",
                    "type": "string"
                  }
                },
                "required": [
                  "path",
                  "service",
                  "port"
                ],
                "type": "object"
              },
              "type": "array"
            },
            "image": {
              "description": "Image to use for deployment",
              "type": "string"
            },
            "remote": {
              "description": "Whether to run commands remotely",
              "type": "boolean"
            }
          },
          "type": "object"
        }
      ],
      "title": "deploy",
      "type": [
        "array",
        "object"
      ]
    },
    "destroy": {
      "description": "Allows destroying resources created by your development environment. Can be either a list of commands or an object (destroy.image",
      "oneOf": [
        {
          "type": "object"
        },
        {
          "type": "array"
        }
      ],
      "title": "destroy"
    },
    "dev": {
      "additionalProperties": false,
      "description": "A list of development containers to define the behavior of okteto up and synchronize your code in your development environment.",
      "patternProperties": {
        ".*": {
          "additionalProperties": false,
          "properties": {
            "command": {
              "description": "The command of your development container. If empty, it defaults to sh. The command can also be a list",
              "oneOf": [
                {
                  "default": "sh",
                  "type": "string"
                },
                {
                  "items": {
                    "type": "string"
                  },
                  "type": "object"
                }
              ],
              "title": "command",
              "type": [
                "array",
                "string"
              ]
            },
            "forward": {
              "oneOf": [
                {
                  "items": {
                    "pattern": "^[0-9]+:[0-9]+$",
                    "type": "string"
                  },
                  "type": "object"
                }
              ],
              "title": "forward",
              "type": "object"
            },
            "mode": {
              "default": "sync",
              "description": "Container mode (sync, hybrid)",
              "enum": [
                "sync",
                "hybrid"
              ],
              "title": "mode",
              "type": "string"
            },
            "sync": {
              "oneOf": [
                {
                  "items": {
                    "pattern": "^.*:.*$",
                    "type": "string"
                  },
                  "type": "object"
                }
              ],
              "title": "sync",
              "type": "object"
            }
          },
          "type": "object"
        }
      },
      "title": "dev",
      "type": "object"
    },
    "external": {
      "additionalProperties": false,
      "description": "A list of external resources that are part of your development environment. Use this section for resources that are deployed outside of the okteto cluster like Cloud resources or dashboards.",
      "patternProperties": {
        ".*": {
          "additionalProperties": false,
          "properties": {
            "endpoints": {
              "items": {
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "url": {
                    "format": "https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?\u0026//=]*)",
                    "type": "string"
                  }
                },
                "required": [
                  "url"
                ],
                "type": "object"
              },
              "type": "array"
            },
            "icon": {
              "type": "string"
            },
            "notes": {
              "type": "string"
            }
          },
          "type": "object"
        }
      },
      "title": "external",
      "type": "object"
    },
    "forward": {
      "description": "When declaring a global forward Okteto will automatically handle port collision when two or more okteto up sessions are running simultaneously. If the okteto up session detects that the port is already in use and said port is defined as global forward okteto up will ignore the port collision and continue the up sequence. If the port is later available okteto up session will automatically connect to it without interrupting the session.",
      "items": {
        "anyOf": [
          {
            "pattern": "^[0-9]+:([a-zA-Z0-9]+:)?[0-9]+$",
            "type": "string"
          },
          {
            "additionalProperties": false,
            "properties": {
              "labels": {
                "additionalProperties": {
                  "type": "string"
                },
                "type": "object"
              },
              "localPort": {
                "type": "integer"
              },
              "name": {
                "type": "string"
              },
              "remotePort": {
                "type": "integer"
              }
            },
            "required": [
              "localPort",
              "remotePort"
            ],
            "type": "object"
          }
        ]
      },
      "title": "forward",
      "type": "array"
    },
    "icon": {
      "anyOf": [
        {
          "default": "default",
          "enum": [
            "default",
            "container",
            "dashboard",
            "database",
            "function",
            "graph",
            "storage",
            "launchdarkly",
            "mongodb",
            "gcp",
            "aws",
            "okteto"
          ],
          "type": "string"
        },
        {
          "pattern": "[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?\u0026/=]*)",
          "type": "string"
        }
      ],
      "description": "Sets the icon that will be shown in the Okteto UI.",
      "title": "icon",
      "type": "string"
    },
    "image": {
      "description": "The name of the image to build and push. In clusters that have Okteto installed",
      "title": "image",
      "type": "string"
    },
    "name": {
      "description": "The name of your development environment. It defaults to the name of your git repository.",
      "title": "name",
      "type": "string"
    },
    "namespace": {
      "description": "The namespace where the development environment is deployed. By default",
      "title": "namespace",
      "type": "string"
    },
    "test": {
      "additionalProperties": false,
      "description": "The test configuration for your development environment. This feature is only supported in clusters that have Okteto installed.",
      "patternProperties": {
        ".*": {
          "additionalProperties": false,
          "properties": {
            "caches": {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "commands": {
              "oneOf": [
                {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                {
                  "items": {
                    "additionalProperties": false,
                    "properties": {
                      "command": {
                        "type": "string"
                      },
                      "name": {
                        "type": "string"
                      }
                    },
                    "type": "object"
                  },
                  "type": "array"
                }
              ],
              "type": [
                "array",
                "string"
              ]
            },
            "context": {
              "description": "The build context. Relative paths are relative to the location of the Okteto Manifest (default: .)",
              "title": "context",
              "type": "string"
            },
            "depends_on": {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "image": {
              "description": "The image to use for the test container",
              "title": "image",
              "type": "string"
            }
          },
          "type": "object"
        }
      },
      "title": "test",
      "type": "object"
    }
  },
  "title": "Okteto Manifest",
  "type": "object"
}